/**!
 * @Project: angular-ajax-interceptor
 * @Authors: [Hitmands <gius.mand.developer@gmail.com>, Luca Pau <luca.pau82@gmail.com>]
 * @Link: https://github.com/Code-Y/angular-ajax-interceptor
 * @License: MIT
 * @Date: 2015-04-17
 * @Version: 1.0.0
***/

!function(a,b){"use strict";function c(a){var b=a.adapt;if(f(b))return null;for(var c in i)if(i.hasOwnProperty(c)&&i[c]===b)return b;return null}function d(a,b,c,d){var e=a.config.adapt;if(!e)return a||b(a);switch(e){case i.list:return b(new ListAjaxResponse(a));case i.simple:return b(new SimpleAjaxResponse(a));case i.form:return b(new FormAjaxResponse(a));case i.error:return c(new ErrorAjaxResponse(a));default:return d.warn('AjaxAdapter [UNRECOGNIZED "'+e+'" RESPONSE TYPE]',a),b(new SimpleAjaxResponse(a))}}function e(a){var e=this;e.types=function(a){return b.extend(i,a),e},e.setHeaderKey=function(a){return b.isString(a)&&(k=a),e},e.ignoreType=function(a){return b.isString(a)&&j.push(a),e},a.interceptors.push(["$q","$log",function(a,b){var e=a.when,f=a.reject;return{request:function(a){var b=c(a);if(!b)return a||e(a);switch(b){case i.form:a.data=a.adaptAsPlainData?a.data:{fields:a.data}}return a||e(a)},response:function(a){return d(a,e,f,b)},responseError:function(a){if(!a.config.adapt)return f(a);switch(a.config.adapt){case"form":return f(new FormAjaxResponse(a,!0));default:return f(new ErrorAjaxResponse(a))}}}}]),e.$get=function(){return new AjaxAdapter}}e.$inject=["$httpProvider"];var f=b.isUndefined,g=b.isArray,h=function(a){return b.isObject(a)&&!g(a)},i={form:"form",upload:"upload",simple:"simple",list:"list",error:"error"},j=["error"],k="x-ajax-adapt";b.module("Code-Y.ajax",[]).provider("AjaxInterceptor",e);var AjaxAdapter=function(){function AjaxAdapter(){var a=new RegExp(j.join("|"));b.forEach(i,function(b,c){var d="setType"+(c.charAt(0).toUpperCase()+c.slice(1));a.test(c)||(this[d]=function(a){return this._setType(a,b)})},this)}return AjaxAdapter.prototype._types=i,AjaxAdapter.prototype._setType=function(a,b){return h(a)&&(a.adapt=b),this},AjaxAdapter}.call(this),l=function(){function a(a){this.code=a.status,this.message=h(a.data)&&a.data.message?a.data.message:a.statusText,this.type="Response",this.success=this.code>=200&&this.code<300,this._res=a}return a}.call(this),m=function(a){function b(){this.constructor=a}for(var c in l)l.hasOwnProperty(c)&&(a[c]=l[c]);return b.prototype=l.prototype,a.prototype=new b,a.__super__=l.prototype,a},ErrorAjaxResponse=function(){function ErrorAjaxResponse(){ErrorAjaxResponse.__super__.constructor.apply(this,arguments),this.success=!1,this.type=i.error}return m(ErrorAjaxResponse),ErrorAjaxResponse}.call(this),FormAjaxResponse=function(){function FormAjaxResponse(a,b){FormAjaxResponse.__super__.constructor.apply(this,arguments),this.type=i.form,this.value=a.data.value||{},this.errors=a.data.errors||[],this.errorsCount=a.data.errorCount||this.errors.length,this.hasErrors=this.errors.length>0,b===!0&&(this.success=!1)}return m(FormAjaxResponse),FormAjaxResponse}.call(this),ListAjaxResponse=function(){function ListAjaxResponse(a){ListAjaxResponse.__super__.constructor.apply(this,arguments),this.type=i.list,this.items=a.data.items||[],this.value=a.data.value||{},this.totalPages=a.data.totalPages||1,this.currentPage=a.data.currentPage||this.totalPages}return m(ListAjaxResponse),ListAjaxResponse}.call(this),SimpleAjaxResponse=function(){function SimpleAjaxResponse(a){SimpleAjaxResponse.__super__.constructor.apply(this,arguments),this.value=a.data.value||{},this.type=i.simple}return m(SimpleAjaxResponse),SimpleAjaxResponse}.call(this)}(window,angular);
